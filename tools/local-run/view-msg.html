<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>DEX HL7</title>

		<script type="text/javascript" src="js/json-viewer.js"></script>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/json-viewer.css">
		<style>
			body {
				margin:20px
			}
			#json {
				margin-top:20px;
			}
		</style>
	</head>
<body>
	<h5>DEX HL7 MESSAGE VIEWER</h5>
	<div>
		<input class="form-control" id="file-selector" type="file">
	</div>
	<pre id="json"></pre>
	<script>
		/*
				fr.onload=function() {
					/* hl7 parsing
					const segments = fr.result.split('\n')
					const hl7parsed = segments.map(seg => {
						const fields = seg.split('|')
						return fields.map(fld =>
							fld.includes('^') ? fld.split('^'):fld
						)
					})
					console.log(JSON.stringify(hl7parsed, null, '  '))
					document.getElementById("json").innerHTML = JSON.stringify(hl7parsed, null, 2)
	     */
		document.getElementById('file-selector')
		    .addEventListener('change', ({target}) => {
				const {files} =  target
			    const fr = new FileReader()
				fr.onload=function() {
					jsonViewer.showJSON(JSON.parse(fr.result))
				}
				fr.readAsText(files[0]);
			}
		)
		let jsonViewer = new JSONViewer();
		document.querySelector("#json").appendChild(jsonViewer.getContainer());
	</script>
	</body>
</html>
